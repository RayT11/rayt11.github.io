enabled: true

commands:
  - name: tempmail
    description: "Generate a temporary email address. Expires in 30 minutes."
    actions:
      - id: if
        args:
          condition: "%context.guild_id% != null"
          met-actions:
            - id: sendEmbed
              args:
                title: "‚ùå This command can only be used in DMs!"
                description: "Please send this command in a private message with the bot."
                color: "#5865F2"
                ephemeral: true
          stop: true

      - id: fetch
        args:
          url: "https://www.1secmail.com/api/v1/?action=genRandomMailbox"
          method: GET
        store: temp_email

      - id: sendEmbed
        args:
          title: "üì¨ Temporary Email Generated"
          description: "Your temporary email is:\n**`%temp_email[0]%`**\n\nUse `/checkmail` to check for new messages.\nThis email will expire in **30 minutes**."
          color: "#5865F2"
          footer: "Your temp email will be deleted automatically after 30 minutes."
          ephemeral: true

      - id: delay
        args:
          time: 1800 # 30 minutes (1800 seconds)

      - id: deleteVariable
        args:
          variable: temp_email

  - name: checkmail
    description: "Check for new emails in your temporary inbox."
    actions:
      - id: if
        args:
          condition: "%context.guild_id% != null"
          met-actions:
            - id: sendEmbed
              args:
                title: "‚ùå This command can only be used in DMs!"
                description: "Please send this command in a private message with the bot."
                color: "#5865F2"
                ephemeral: true
          stop: true

      - id: if
        args:
          condition: "%temp_email.length% == 0"
          met-actions:
            - id: sendEmbed
              args:
                title: "‚ö†Ô∏è No Temporary Email Found"
                description: "You don't have an active temporary email. Use `/tempmail` to generate one."
                color: "#5865F2"
                ephemeral: true
          stop: true

      - id: regex
        args:
          pattern: "(.*)@(.*)"
          text: "%temp_email[0]%"
        store: email_parts

      - id: fetch
        args:
          url: "https://www.1secmail.com/api/v1/?action=getMessages&login=%email_parts[1]%&domain=%email_parts[2]%"
          method: GET
        store: emails

      - id: if
        args:
          condition: "%emails.length% == 0"
          met-actions:
            - id: sendEmbed
              args:
                title: "üì≠ No New Emails"
                description: "Your inbox is empty. Try again later."
                color: "#5865F2"
                ephemeral: true
          not-met-actions:
            - id: sendEmbed
              args:
                title: "üì© New Emails Found"
                description: "You have **%emails.length%** new email(s). Use `/readmail <id>` to read them."
                color: "#5865F2"
                ephemeral: true

  - name: readmail
    description: "Read an email from your temporary inbox."
    options:
      - name: id
        description: "The email ID from /checkmail"
        type: integer
        required: true
    actions:
      - id: if
        args:
          condition: "%context.guild_id% != null"
          met-actions:
            - id: sendEmbed
              args:
                title: "‚ùå This command can only be used in DMs!"
                description: "Please send this command in a private message with the bot."
                color: "#5865F2"
                ephemeral: true
          stop: true

      - id: if
        args:
          condition: "%temp_email.length% == 0"
          met-actions:
            - id: sendEmbed
              args:
                title: "‚ö†Ô∏è No Temporary Email Found"
                description: "You don't have an active temporary email. Use `/tempmail` to generate one."
                color: "#5865F2"
                ephemeral: true
          stop: true

      - id: regex
        args:
          pattern: "(.*)@(.*)"
          text: "%temp_email[0]%"
        store: email_parts

      - id: fetch
        args:
          url: "https://www.1secmail.com/api/v1/?action=readMessage&login=%email_parts[1]%&domain=%email_parts[2]%&id=%id%"
          method: GET
        store: email_content

      - id: sendEmbed
        args:
          title: "üìß Email from %email_content.from%"
          fields:
            - name: "Subject"
              value: "%email_content.subject%"
            - name: "Message"
              value: "```%email_content.textBody%```"
          color: "#5865F2"
          footer: "Use /checkmail to see more emails."
          ephemeral: true
